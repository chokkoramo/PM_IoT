<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Formulario de prueba</title>
    <style>
      body { font-family: Arial; padding: 20px; }
      label { display: block; margin-top: 8px; }
    </style>
  </head>
  <body>
    <h1>Enviar dato (prueba)</h1>

    <form id="testForm">
      <label>Sensor
        <input type="text" name="sensor" value="temp1" />
      </label>

      <label>Valor
        <input type="number" step="any" name="value" value="23.5" />
      </label>

      <label>Meta (JSON)
        <input type="text" name="meta" placeholder='{"ubicacion":"sala"}' />
      </label>

      <button type="submit">Enviar</button>
    </form>

    <pre id="result" style="margin-top:16px; background:#f6f6f6; padding:10px;"></pre>

    <script>
      document.getElementById('testForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const form = e.target;
        const sensor = form.sensor.value || null;
        const value = parseFloat(form.value.value);
        let meta = null;

        try {
          meta = form.meta.value ? JSON.parse(form.meta.value) : null;
        } catch (err) {
          meta = form.meta.value; // si no es JSON v√°lido, lo env√≠a como texto
        }

        const payload = { sensor, value, meta };
        const resEl = document.getElementById('result');
        resEl.textContent = 'Enviando...';

        try {
          const resp = await fetch('/api/data', {   // üîπ Aqu√≠ el cambio importante
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          const data = await resp.json();
          resEl.textContent = JSON.stringify({ status: resp.status, body: data }, null, 2);
        } catch (err) {
          resEl.textContent = 'Error: ' + err.message;
        }
      });
    </script>
  </body>
</html>